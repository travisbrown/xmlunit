<project name="xmlunit" default="test" basedir=".">
  <property name="version" value="0.4"/>
  <property name="src.dir" value="src"/>
  <property name="lib.dir" value="lib"/>
  <property name="out.dir" value="classes"/>
  <property name="dist.dir" value="dist"/>
  <property name="docs.dir" value="doc"/>
  <property name="test.report.dir" value="junit"/>
  <property name="xml.parser" value="${ant.home}/lib/xerces.jar"/>
  <property name="xsl.engine" value="${ant.home}/lib/xalan.jar"/>

  <target name="prepare">
    <mkdir dir="${src.dir}/etc"/>
    <mkdir dir="${lib.dir}"/>
    <mkdir dir="${out.dir}"/>
    <mkdir dir="${dist.dir}"/>
    <mkdir dir="${test.report.dir}"/>
  </target>

  <target name="clean" depends="prepare">
    <delete includeEmptyDirs="true" >
      <fileset dir="${out.dir}" includes="**/*.class"/>
      <fileset dir="${test.report.dir}" includes="**/TEST*.txt"/>
    </delete>
  </target>

  <target name="compile" depends="prepare">
    <mkdir dir="${out.dir}"/>
    <javac srcdir="${src.dir}/java" destdir="${out.dir}">
      <classpath>
        <fileset dir="${lib.dir}">
            <include name="*.jar"/>
        </fileset>
        <pathelement path="${java.class.path}"/>
      </classpath>
    </javac>
    <copy todir="${out.dir}/etc">
      <fileset dir="${src.dir}/etc"/>
    </copy>
  </target>

  <target name="test" depends="compile">
    <mkdir dir="${test.report.dir}"/>
    <junit printsummary="yes" haltonfailure="no" fork="yes">
      <sysproperty key="basedir" value="${basedir}"/>
      <sysproperty key="javax.xml.parsers.DocumentBuilderFactory"
        value="org.apache.xerces.jaxp.DocumentBuilderFactoryImpl"/>
      <sysproperty key="javax.xml.parsers.SAXParserFactory"
        value="org.apache.xerces.jaxp.SAXParserFactoryImpl"/>
      <sysproperty key="javax.xml.transform.TransformerFactory"
        value="org.apache.xalan.processor.TransformerFactoryImpl"/>
      <classpath>
        <pathelement location="${out.dir}"/>
        <pathelement location="${xml.parser}"/>
        <pathelement location="${xsl.engine}"/>
      </classpath>
      <formatter type="plain" usefile="no"/>
      <batchtest fork="yes">
        <fileset dir="${src.dir}/java">
          <include name="**/test_*.java"/>
        </fileset>
      </batchtest>
    </junit>
  </target>

  <target name="set-dist-version" depends="prepare">
    <replace dir="${src.dir}" token="@@version@@" value="${version}"
       includes="**/*.java"/>
  </target>

  <target name="docs" depends="prepare">
    <mkdir dir="${docs.dir}"/>
    <delete includeEmptyDirs="true" dir="${docs.dir}/org"/>
    <javadoc sourcepath="${src.dir}/java" destdir="${docs.dir}"
      packagenames="org.custommonkey.xmlunit.*"
      overview="${basedir}/overview.html"
      windowtitle="XMLUnit Documentation"
      footer="&lt;p&gt;&lt;a href=&quot;http://xmlunit.sourceforge.net/&quot;&gt;XMLUnit&lt;/a&gt; is hosted by sourceforge.net&lt;/p&gt;">
      <group title="XMLUnit v${version}"
        packages="org.custommonkey.xmlunit*"/>
      <classpath>
        <fileset dir="${lib.dir}">
            <include name="*.jar"/>
        </fileset>
        <pathelement path="${java.class.path}"/>
      </classpath>
    </javadoc>
  </target>

  <target name="dist" depends="clean,set-dist-version,docs,compile">
    <jar jarfile="${lib.dir}/xmlunit.jar"
       basedir="${out.dir}"
       excludes="**/test_*.class"
    />

    <zip zipfile="${dist.dir}/xmlunit${version}.zip" basedir="${basedir}"
       includes="**/*.java,**/*.txt,**/*.jar,**/*.xml,**/*.xsl,${docs.dir}/**/*.html"
    />
  </target>

</project>
